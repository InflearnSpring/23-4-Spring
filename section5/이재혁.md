## ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‹±ê¸€í†¤

- ìŠ¤í”„ë§ì€ íƒœìƒì´ ê¸°ì—…ìš© ì„œë¹„ìŠ¤ ê¸°ìˆ ì„ ì§€ì›í•˜ê¸° ìœ„í•´ íƒ„ìƒí–ˆë‹¤.
- ëŒ€ë¶€ë¶„ì˜ ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤. ë¬¼ë¡  ì›¹ì´ ì•„ë‹Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œë„ ì–¼ë§ˆë“ ì§€ ê°œë°œí•  ìˆ˜ ìˆë‹¤.
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë³´í†µ ì—¬ëŸ¬ ê³ ê°ì´ ë™ì‹œì— ìš”ì²­ì„ í•œë‹¤.

<aside>
ğŸ’¡ ë¬¸ì œëŠ” ê³ ê°ì˜ ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ê°ì²´ë¥¼ ê³„ì† ë§Œë“¤ì–´ì•¼ í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

</aside>

- ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸

```java
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberService;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

public class SingletonTest {

    @Test
    @DisplayName("ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆ")
    void pureContainer() {
        AppConfig appConfig = new AppConfig();
        //1. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
        MemberService memberService1 = appConfig.memberService();

        //2. ì¡°íšŒ: í˜¸ì¶œí•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒì„±
        MemberService memberService2 = appConfig.memberService();

        //ì°¸ì¡°ê°’ì´ ë‹¤ë¥¸ ê²ƒì„ í™•ì¸
        System.out.println("memberService1 = " + memberService1);
        System.out.println("memberService2 = " + memberService2);

        // 1ê³¼ 2ê°€ ë‹¤ë¥´ë‹¤
        Assertions.assertThat(memberService1).isNotSameAs(memberService2);

    }
}
```

- ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ ìŠ¤í”„ë§ ì—†ëŠ” ìˆœìˆ˜í•œ DI ì»¨í…Œì´ë„ˆì¸ AppConfigëŠ” ìš”ì²­ì„ í•  ë•Œ ë§ˆë‹¤ ê°ì²´ë¥¼ ìƒˆë¡œ ìƒì„±í•œë‹¤.
- ê³ ê° íŠ¸ë˜í”½ì´ ì´ˆë‹¹ 100ì´ ë‚˜ì˜¤ë©´ ì´ˆë‹¹ 100ê°œ ê°ì²´ê°€ ìƒì„±ë˜ê³  ì†Œë©¸ëœë‹¤! â†’ ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í•˜ë‹¤
- í•´ê²°ë°©ì•ˆì€ í•´ë‹¹ ê°ì²´ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ê³ , **ê³µìœ **í•˜ë„ë¡ ì„¤ê³„í•˜ë©´ ëœë‹¤. â†’ **ì‹±ê¸€í†¤ íŒ¨í„´**

## ì‹±ê¸€í†¤ íŒ¨í„´

- í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë”± 1ê°œë§Œ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³´ì¥í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì´ë‹¤.
- ê·¸ë˜ì„œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ 2ê°œ ì´ìƒ ìƒì„±í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤.
    - private ìƒì„±ìë¥¼ ì‚¬ìš©í•´ì„œ ì™¸ë¶€ì—ì„œ ì„ì˜ì˜ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ëª»í•˜ë„ë¡ ë§‰ì•„ì•¼ í•œë‹¤.

```java
package hello.core.singleton;

public class SingletonService {

    //1. static ì˜ì—­ì— ê°ì²´ë¥¼ ë”± 1ê°œë§Œ ìƒì„±í•´ë‘”ë‹¤.
    private static final SingletonService instance = new SingletonService();

    //2. publicìœ¼ë¡œ ì—´ì–´ì„œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ê°€ í•„ìš”í•˜ë©´ ì´ static ë©”ì„œë“œë¥¼ í†µí•´ì„œë§Œ ì¡°íšŒí•˜ë„ë¡ í—ˆìš©í•œë‹¤.
    public static SingletonService getInstance() {
        return instance;
    }

    //3. ìƒì„±ìë¥¼ privateìœ¼ë¡œ ì„ ì–¸í•´ì„œ ì™¸ë¶€ì—ì„œ new í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•œ ê°ì²´ ìƒì„±ì„ ë§‰ëŠ”ë‹¤.
    private SingletonService() {}

    public void logic() {
        System.out.println("ì‹±ê¸€í†¤ ê°ì²´ ë¡œì§ í˜¸ì¶œ");
    }

}
```

<aside>
ğŸ’¡ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ê¸°ë³¸ì ìœ¼ë¡œ ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•´ì¤€ë‹¤.

</aside>

â‡’ ì„±ëŠ¥ì´ í–¥ìƒëœë‹¤.

- ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì 
    - ì½”ë“œ ìì²´ê°€ ë§ì´ ë“¤ì–´ê°„ë‹¤
    - í´ë¼ì´ì–¸íŠ¸ê°€ êµ¬ì²´ í´ë˜ìŠ¤ì— ì˜ì¡´í•´ì•¼ í•œë‹¤ â†’ DIP ìœ„ë°˜
    - OCPìœ„ë°˜ ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§„ë‹¤
    - í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µë‹¤
    - ë‚´ë¶€ ì†ì„±ì„ ë³€ê²½í•˜ê±°ë‚˜ ì´ˆê¸°í™”ê°€ ì–´ë µë‹¤
    - private ìƒì„±ìë¡œ ìì‹ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì–´ë µë‹¤
    - ìœ ì—°ì„±ì´ ë–¨ì–´ì§„ë‹¤
    - ì•ˆí‹°íŒ¨í„´ìœ¼ë¡œ ë¶ˆë¦¬ê¸°ë„ í•œë‹¤.

<aside>
ğŸ’¡ ê·¸ëŸ°ë° ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ëŠ” ì´ ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ ì „ë¶€ í•´ê²°í•˜ê³  ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•´ì¤€ë‹¤.

</aside>

## ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ

- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ë¬¸ì œì ì„ í•´ê²°í•˜ë©´ì„œ, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤(1ê°œë§Œ ìƒì„±)ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.
- ì§€ê¸ˆê¹Œì§€ ìš°ë¦¬ê°€ í•™ìŠµí•œ ìŠ¤í”„ë§ ë¹ˆì´ ë°”ë¡œ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ë˜ëŠ” ë¹ˆì´ë‹¤.
- ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ íŒ¨í„´ì„ ì ìš©í•˜ì§€ ì•Šì•„ë„, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•œë‹¤. ì´ë ‡ê²Œ ì‹±ê¸€í†¤ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ â‡’ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¼ í•œë‹¤.
    - ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì´ëŸ° ê¸°ëŠ¥ ë•ë¶„ì— ì‹±ê¸€í†¤ íŒ¨í„´ì˜ ëª¨ë“  ë‹¨ì ì„ í•´ê²°í•˜ë©´ì„œ ê°ì²´ë¥¼ ì‹±ê¸€í†¤ìœ¼ë¡œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

- ì‹±ê¸€í†¤ ì»¨í…Œì´ë„ˆ ì ìš© í›„(ìŠ¤í”„ë§ DI ì»¨í…Œì´ë„ˆ)
    - ì´ë¯¸ ë§Œë“¤ì–´ì§„ ê°ì²´ë¥¼ ê³µìœ í•´ì„œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

## ì‹±ê¸€í†¤ ë°©ì‹ì˜ ì£¼ì˜ì â˜…

- ì‹±ê¸€í†¤ ê°ì²´ëŠ” ìƒíƒœë¥¼ ìœ ì§€(stateful)í•˜ê²Œ ì„¤ê³„í•˜ë©´ ì•ˆëœë‹¤.
- ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•´ì•¼ í•œë‹¤!
    - ê°€ê¸‰ì  ì½ê¸°ë§Œ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.
- ìŠ¤í”„ë§ ë¹ˆì˜ í•„ë“œì— ê³µìœ  ê°’ì„ ì„¤ì •í•˜ë©´ í° ì¥ì• ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤!

```java
package hello.core.singleton;

import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.util.Assert;

import static org.junit.jupiter.api.Assertions.*;

class StatefulServiceTest {

    @Test
    void satefulServiceSingleton() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(TestConfig.class);
        StatefulService statefulService1 = ac.getBean(StatefulService.class);
        StatefulService statefulService2 = ac.getBean(StatefulService.class);

        //ThreadA: Aì‚¬ìš©ì 10000ì› ì£¼ë¬¸
        statefulService1.order("userA", 10000);
        //ThreadB: Bì‚¬ìš©ì 20000ì› ì£¼ë¬¸
        statefulService2.order("userB", 20000);

        //ThreadA: ì‚¬ìš©ìA ì£¼ë¬¸ ê¸ˆì•¡ ì¡°íšŒ
        int price = statefulService1.getPrice();
        System.out.println("price = " + price);

        Assertions.assertThat(statefulService1.getPrice()).isEqualTo(20000);
    }

    static class TestConfig {

        @Bean
        public StatefulService statefulService() {
            return new StatefulService();

        }
    }

}
```

- ê³µìœ ë˜ëŠ” í•„ë“œ ê°’ì„ ë³€ê²½ í•´ë²„ë¦¬ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ìƒê¸´ë‹¤.
- ì‚¬ìš©ì Aì˜ ì£¼ë¬¸ì„œì—ëŠ” 10000ì›ì´ ì•„ë‹Œ 20000ì›ì´ ì°íŒë‹¤.
- ì‹¤ë¬´ì—ì„œëŠ” í•´ê²°í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œê°€ ìƒê¸´ë‹¤
- ê³µìœ í•„ë“œëŠ” ì¡°ì‹¬í•´ì•¼í•œë‹¤! ìŠ¤í”„ë§ ë¹ˆì„ í•­ìƒ ë¬´ìƒíƒœ(stateless)ë¡œ ì„¤ê³„í•˜ì.
    
    

## @Configurationê³¼ ì‹±ê¸€í†¤

```java
package hello.core.singleton;

import hello.core.AppConfig;
import hello.core.member.MemberRepository;
import hello.core.member.MemberServiceImpl;
import hello.core.order.OrderServiceImpl;
import org.assertj.core.api.Assertions;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import static org.assertj.core.api.Assertions.*;

public class ConfigurationSingletonTest {

    @Test
    void configurationTest() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

        MemberServiceImpl memberService = ac.getBean("memberService", MemberServiceImpl.class);
        OrderServiceImpl orderService = ac.getBean("orderService", OrderServiceImpl.class);
        MemberRepository memberRepository = ac.getBean("memberRepository", MemberRepository.class);

        MemberRepository memberRepository1 = memberService.getMemberRepository();
        MemberRepository memberRepository2 = orderService.getMemberRepository();

        System.out.println("memberRepository1 = " + memberRepository1);
        System.out.println("memberRepository2 = " + memberRepository2);
        System.out.println("memberRepository = " + memberRepository);

        assertThat(memberService.getMemberRepository()).isSameAs(memberRepository);
        assertThat(orderService.getMemberRepository()).isSameAs(memberRepository);

    }
}
```

## @Configurationê³¼ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì˜ ë§ˆë²•

- ìˆœìˆ˜í•œ í´ë˜ìŠ¤ë¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë˜ì•¼ í•œë‹¤.
    - class hello.core.AppConfig
- ê·¸ëŸ°ë° ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ í´ë˜ìŠ¤ ëª…ì— xxxCGLIBê°€ ë¶™ìœ¼ë©´ì„œ ìƒë‹¹íˆ ë³µì¡í•´ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì´ê²ƒì€ ë‚´ê°€ ë§Œë“  í´ë˜ìŠ¤ê°€ ì•„ë‹ˆë¼ ìŠ¤í”„ë§ì´ CGLIBë¼ëŠ” ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ AppConfig í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ì„ì˜ì˜ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê·¸ ë‹¤ë¥¸ í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œ ê²ƒì´ë‹¤!

AppConfig@CGLIB ì˜ˆìƒ ì½”ë“œ

```java
@Bean
public MemberRepository memberRepository() {

	if (memoryMemberRepositoryê°€ ì´ë¯¸ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ìˆìœ¼ë©´?) {
		return ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ì°¾ì•„ì„œ ë°˜í™˜;
} else { // ì—†ìœ¼ë©´
		ê¸°ì¡´ ë¡œì§ì„ í˜¸ì¶œí•´ì„œ MemoryMemberRepositoryë¥¼ ìƒì„±í•˜ê³  ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡
		return ë°˜í™˜
}
}
```

- @Beanì´ ë¶™ì€ ë©”ì„œë“œë§ˆë‹¤ ì´ë¯¸ ìŠ¤í”„ë§ ë¹ˆì´ ì¡´ì¬í•˜ë©´ ì¡´ì¬í•˜ëŠ” ë¹ˆì„ ë°˜í™˜í•˜ê³ , ìŠ¤í”„ë§ ë¹ˆì´ ì—†ìœ¼ë©´ ìƒì„±í•´ì„œ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ë°˜í™˜í•˜ëŠ” ì½”ë“œê°€ ë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤.
- ë•ë¶„ì— ì‹±ê¸€í†¤ì´ ë³´ì¥ë˜ëŠ” ê²ƒì´ë‹¤.
- @Beanë§Œ ì‚¬ìš©í•´ë„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì§€ë§Œ, ì‹±ê¸€í†¤ì€ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.
- ìŠ¤í”„ë§ ì„¤ì • ì •ë³´ëŠ” í•­ìƒ @Configurationì„ ì‚¬ìš©í•˜ì